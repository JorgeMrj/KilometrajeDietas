<div class="card bg-white shadow-2xl border-2 border-slate-200 backdrop-blur-lg">
  <div class="card-body p-3">
    <div class="flex items-center justify-between mb-2 flex-wrap gap-2">
      <h2
        class="text-lg font-black text-transparent bg-clip-text bg-linear-to-r from-slate-700 to-gray-700"
      >
        Registro de Dietas
      </h2>
      <div class="badge badge-primary text-xs px-2 py-1">
        {{ registros.length }} {{ registros.length === 1 ? 'registro' : 'registros' }}
      </div>
    </div>
    <div class="overflow-x-auto rounded-lg border border-slate-200 bg-white shadow-inner">
      <table class="table table-sm">
        <thead>
          <tr
            class="bg-linear-to-r from-slate-100 via-gray-100 to-slate-100 text-gray-800 border-b-2 border-slate-300"
          >
            <th class="text-center font-bold text-xs">
              <div class="flex items-center justify-center gap-1">Fecha</div>
            </th>
            <th class="text-center font-bold text-xs">
              <div class="flex items-center justify-center gap-1">Ciudad</div>
            </th>
            <th class="text-center font-bold text-xs">
              <div class="flex items-center justify-center gap-1">Kilómetros</div>
            </th>
            <th class="text-center font-bold text-xs">
              <div class="flex items-center justify-center gap-1">Acciones</div>
            </th>
          </tr>
        </thead>
        <tbody>
          <tr
            *ngFor="let registro of registros; let i = index"
            class="hover:bg-slate-50 transition-all duration-200 border-b border-gray-200"
          >
            <td class="text-center text-sm font-semibold text-slate-700">
              {{ registro.fecha }}
            </td>
            <td class="text-center text-sm text-gray-700">{{ registro.ciudad }}</td>
            <td class="text-center">
              <div class="badge badge-success badge-sm text-xs font-bold">{{ registro.km }} km</div>
            </td>
            <td class="text-center">
              <button
                class="btn btn-error btn-xs hover:scale-110 transition-all duration-300 text-xs"
                (click)="eliminarRegistro(i)"
                title="Eliminar registro"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="h-3 w-3"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"
                  />
                </svg>
                Borrar
              </button>
            </td>
          </tr>
          <tr *ngIf="registros.length === 0">
            <td colspan="4" class="text-center py-4">
              <div class="flex flex-col items-center gap-1">
                <p class="text-xs text-gray-600 font-semibold">No hay registros aún</p>
                <p class="text-[10px] text-gray-500">
                  Añade una dieta usando el formulario de arriba
                </p>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="mt-2">
      <div class="divider text-sm">
        <span
          class="text-sm font-black text-transparent bg-clip-text bg-linear-to-r from-slate-600 to-gray-600"
        >
          Totales
        </span>
      </div>

      <div
        class="stats stats-vertical sm:stats-horizontal shadow-xl w-full bg-linear-to-br from-white to-slate-50 border border-slate-200 overflow-hidden"
      >
        <div class="stat bg-linear-to-br from-cyan-50 to-blue-50 place-items-center py-2">
          <div class="stat-figure text-cyan-600">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              class="inline-block w-5 h-5 stroke-current drop-shadow-lg"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M13 10V3L4 14h7v7l9-11h-7z"
              />
            </svg>
          </div>
          <div class="stat-title text-cyan-700 font-bold text-[10px]">Kilómetros Totales</div>
          <div class="stat-value text-cyan-600 text-xl drop-shadow-lg">{{ kmTotales }}</div>
          <div class="stat-desc text-slate-500 text-[10px]">Suma de todos los registros</div>
        </div>

        <div class="stat bg-linear-to-br from-teal-50 to-emerald-50 place-items-center py-2">
          <div class="stat-figure text-teal-600">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              class="inline-block w-5 h-5 stroke-current drop-shadow-lg"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
              />
            </svg>
          </div>
          <div class="stat-title text-teal-700 font-bold text-[10px]">Importe Total</div>
          <div class="stat-value text-teal-600 text-xl drop-shadow-lg">
            {{ importeTotal | number: '1.2-2' }} €
          </div>
          <div class="stat-desc text-slate-500 text-[10px]">0.23 € por kilómetro</div>
        </div>
      </div>
    </div>
    <div class="mt-2 text-center">
      <button
        class="btn btn-primary btn-xs gap-1 hover:scale-105 transition-transform shadow-lg text-xs font-semibold"
        (click)="abrirModal()"
        [disabled]="registros.length === 0"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-3 w-3"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"
          />
        </svg>
        Grabar Datos
      </button>
    </div>
  </div>
</div>

<dialog id="modal_grabar" class="modal" [class.modal-open]="mostrarModal">
  <div class="modal-box max-w-3xl bg-white border-2 border-slate-200 p-3">
    <h3
      class="font-bold text-base mb-2 text-transparent bg-clip-text bg-linear-to-r from-slate-700 to-gray-700"
    >
      Datos Enviados
    </h3>

    <div class="py-1">
      <div class="bg-slate-50 p-2 rounded-lg mb-2 border border-slate-200">
        <h4 class="font-semibold text-xs mb-1 text-slate-700">Resumen</h4>
        <div class="grid grid-cols-2 gap-1.5 text-[10px]">
          <div>
            <span class="text-slate-600">Total registros:</span>
            <span class="font-bold text-slate-800">{{ registros.length }}</span>
          </div>
          <div>
            <span class="text-slate-600">Total kilómetros:</span>
            <span class="font-bold text-cyan-600">{{ kmTotales }} km</span>
          </div>
          <div>
            <span class="text-slate-600">Importe total:</span>
            <span class="font-bold text-teal-600">{{ importeTotal | number: '1.2-2' }} €</span>
          </div>
          <div>
            <span class="text-slate-600">Precio/km:</span>
            <span class="font-bold text-amber-600">{{ PRECIO_KM }} €</span>
          </div>
        </div>
      </div>

      <div class="bg-gray-50 p-2 rounded-lg border border-gray-200 max-h-60 overflow-y-auto">
        <h4 class="font-semibold text-xs mb-1.5 text-slate-700">Detalle de Registros</h4>
        <div class="space-y-1.5">
          @for (registro of registros; track $index) {
            <div
              class="bg-white p-1.5 rounded border border-gray-200 hover:border-slate-300 transition-colors"
            >
              <div class="grid grid-cols-2 md:grid-cols-4 gap-1 text-[10px]">
                <div>
                  <span class="text-slate-500 block text-[9px] mb-0.5">Fecha</span>
                  <span class="font-semibold text-slate-700">{{ registro.fecha }}</span>
                </div>
                <div>
                  <span class="text-slate-500 block text-[9px] mb-0.5">Ciudad</span>
                  <span class="font-semibold text-gray-800">{{ registro.ciudad }}</span>
                </div>
                <div>
                  <span class="text-slate-500 block text-[9px] mb-0.5">Kilómetros</span>
                  <span class="font-semibold text-cyan-600">{{ registro.km }} km</span>
                </div>
                <div>
                  <span class="text-slate-500 block text-[9px] mb-0.5">Importe</span>
                  <span class="font-semibold text-teal-600"
                    >{{ registro.km * PRECIO_KM | number: '1.2-2' }} €</span
                  >
                </div>
              </div>
            </div>
          }
        </div>
      </div>
    </div>

    <div class="modal-action mt-2">
      <button class="btn btn-primary btn-xs" (click)="cerrarModal()">Aceptar</button>
    </div>
  </div>
  <form method="dialog" class="modal-backdrop">
    <button (click)="cerrarModal()">close</button>
  </form>
</dialog>
